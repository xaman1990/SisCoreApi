{
  "info": {
    "name": "TimeControl API",
    "description": "Colección de endpoints para TimeControl API - Sistema de control de tiempo multiempresa",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}",
                "description": "Subdominio de la empresa"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"usuario@ejemplo.com\",\n  \"password\": \"password123\",\n  \"deviceId\": \"device-123\",\n  \"deviceName\": \"Mi Dispositivo\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            },
            "description": "Iniciar sesión con email/password o teléfono/password"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set(\"accessToken\", jsonData.accessToken);",
                  "    pm.collectionVariables.set(\"refreshToken\", jsonData.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Refresh Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\",\n  \"deviceId\": \"device-123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/refresh",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "refresh"
              ]
            },
            "description": "Refrescar token de acceso"
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/logout",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "logout"
              ]
            },
            "description": "Cerrar sesión"
          },
          "response": []
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/me",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "me"
              ]
            },
            "description": "Obtener información del usuario actual"
          },
          "response": []
        },
        {
          "name": "Validate Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/validate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "validate"
              ]
            },
            "description": "Validar token de acceso"
          },
          "response": []
        }
      ],
      "description": "Endpoints de autenticación"
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Register User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nuevo@ejemplo.com\",\n  \"password\": \"password123\",\n  \"fullName\": \"Nuevo Usuario\",\n  \"employeeNumber\": \"EMP001\",\n  \"roleIds\": [1]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "description": "Registrar nuevo usuario"
          },
          "response": []
        },
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users"
              ]
            },
            "description": "Obtener todos los usuarios"
          },
          "response": []
        },
        {
          "name": "Get User by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Obtener usuario por ID"
          },
          "response": []
        },
        {
          "name": "Update User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"actualizado@ejemplo.com\",\n  \"fullName\": \"Usuario Actualizado\",\n  \"employeeNumber\": \"EMP002\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Actualizar usuario"
          },
          "response": []
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/users/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Eliminar usuario (soft delete)"
          },
          "response": []
        },
        {
          "name": "Assign Roles to User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"roleIds\": [1, 2]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users/:id/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "users",
                ":id",
                "roles"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Asignar roles a usuario"
          },
          "response": []
        }
      ],
      "description": "Endpoints de gestión de usuarios"
    },
    {
      "name": "Roles",
      "item": [
        {
          "name": "Get All Roles",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles"
              ]
            },
            "description": "Obtener todos los roles"
          },
          "response": []
        },
        {
          "name": "Get Role by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/roles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Obtener rol por ID"
          },
          "response": []
        },
        {
          "name": "Create Role",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Nuevo Rol\",\n  \"description\": \"Descripción del nuevo rol\",\n  \"permissionIds\": [1, 2, 3]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles"
              ]
            },
            "description": "Crear nuevo rol"
          },
          "response": []
        },
        {
          "name": "Update Role",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Rol Actualizado\",\n  \"description\": \"Nueva descripción\",\n  \"permissionIds\": [1, 2, 3, 4]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/roles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Actualizar rol"
          },
          "response": []
        },
        {
          "name": "Delete Role",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/roles/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Eliminar rol (soft delete)"
          },
          "response": []
        }
      ],
      "description": "Endpoints de gestión de roles"
    },
    {
      "name": "Master Users",
      "item": [
        {
          "name": "Register Master User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenantUserId\": 1,\n  \"tenantSubdomain\": \"siscore\",\n  \"isGod\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers",
                "register"
              ]
            },
            "description": "Registrar un usuario tenant como usuario maestro (multi-empresa). Solo usuarios God pueden asignar rol God."
          },
          "response": []
        },
        {
          "name": "Get All Master Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers?isGod=false",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers"
              ],
              "query": [
                {
                  "key": "isGod",
                  "value": "false",
                  "disabled": false,
                  "description": "Filtrar por rol God (opcional). Solo usuarios God pueden usar isGod=true"
                }
              ]
            },
            "description": "Obtener todos los usuarios maestros. Solo usuarios God pueden ver otros usuarios God."
          },
          "response": []
        },
        {
          "name": "Get Master User by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Obtener usuario maestro por ID"
          },
          "response": []
        },
        {
          "name": "Assign Company to Master User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"masterUserId\": 1,\n  \"companyId\": 2,\n  \"role\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers/assign-company",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers",
                "assign-company"
              ]
            },
            "description": "Asignar empresa a usuario maestro. Solo usuarios God pueden hacer esto. Roles válidos: god, owner, admin, viewer"
          },
          "response": []
        },
        {
          "name": "Revoke Company from Master User",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers/:masterUserId/companies/:companyId",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers",
                ":masterUserId",
                "companies",
                ":companyId"
              ],
              "variable": [
                {
                  "key": "masterUserId",
                  "value": "1"
                },
                {
                  "key": "companyId",
                  "value": "2"
                }
              ]
            },
            "description": "Revocar acceso a empresa de usuario maestro. Solo usuarios God pueden hacer esto."
          },
          "response": []
        },
        {
          "name": "Check if User is God",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/masterusers/check-god",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "masterusers",
                "check-god"
              ]
            },
            "description": "Verificar si el usuario actual tiene rol God"
          },
          "response": []
        }
      ],
      "description": "Endpoints de gestión de usuarios maestros (multi-empresa)"
    },
    {
      "name": "Master Companies",
      "item": [
        {
          "name": "Get All Companies",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/companies",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "companies"
              ]
            },
            "description": "Obtener todas las empresas registradas en el sistema"
          },
          "response": []
        },
        {
          "name": "Get Company by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/master/companies/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "companies",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Obtener empresa por ID"
          },
          "response": []
        },
        {
          "name": "Create Company",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Nueva Empresa\",\n  \"subdomain\": \"nuevaempresa\",\n  \"dbHost\": \"localhost\",\n  \"dbPort\": 3306,\n  \"dbName\": \"nueva_empresa\",\n  \"dbUser\": \"root\",\n  \"dbPassword\": \"password123\",\n  \"connectionOptions\": \"SslMode=None\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/master/companies",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "companies"
              ]
            },
            "description": "Crear nueva empresa (tenant)"
          },
          "response": []
        },
        {
          "name": "Update Company",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Empresa Actualizada\",\n  \"dbHost\": \"192.168.1.100\",\n  \"dbPort\": 3307,\n  \"dbName\": \"empresa_actualizada\",\n  \"dbUser\": \"usuario\",\n  \"dbPassword\": \"nuevo_password\",\n  \"connectionOptions\": \"SslMode=None;ConnectionTimeout=30\",\n  \"status\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/master/companies/:id",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "companies",
                ":id"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Actualizar empresa"
          },
          "response": []
        },
        {
          "name": "Update Company Connection",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"dbHost\": \"192.168.1.100\",\n  \"dbPort\": 3307,\n  \"dbName\": \"empresa_bd\",\n  \"dbUser\": \"usuario\",\n  \"dbPassword\": \"password\",\n  \"connectionOptions\": \"SslMode=None;ConnectionTimeout=30\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/master/companies/:id/connection",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "master",
                "companies",
                ":id",
                "connection"
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "1"
                }
              ]
            },
            "description": "Actualizar solo la configuración de conexión de una empresa"
          },
          "response": []
        }
      ],
      "description": "Endpoints de gestión de empresas (tenants) en la BD maestra"
    },
    {
      "name": "Diagnostics",
      "item": [
        {
          "name": "Get Tenant Diagnostics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-Tenant",
                "value": "{{tenant}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/diagnostics/tenant?tenant={{tenant}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "diagnostics",
                "tenant"
              ],
              "query": [
                {
                  "key": "tenant",
                  "value": "{{tenant}}",
                  "disabled": false,
                  "description": "Subdomain de la empresa (alternativa al header X-Tenant)"
                }
              ]
            },
            "description": "Endpoint de diagnóstico para verificar la configuración del tenant"
          },
          "response": []
        },
        {
          "name": "Check Master Database",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/diagnostics/master-db",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "diagnostics",
                "master-db"
              ]
            },
            "description": "Verificar conexión a la BD maestra"
          },
          "response": []
        },
        {
          "name": "Generate Password Hash",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/diagnostics/generate-password-hash",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "diagnostics",
                "generate-password-hash"
              ]
            },
            "description": "Generar hash de contraseña (SOLO PARA DESARROLLO - ELIMINAR EN PRODUCCIÓN)"
          },
          "response": []
        }
      ],
      "description": "Endpoints de diagnóstico y utilidades"
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://localhost:5001",
      "type": "string"
    },
    {
      "key": "tenant",
      "value": "siscore",
      "type": "string",
      "description": "Subdominio de la empresa (SisCore)"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "refreshToken",
      "value": "",
      "type": "string"
    }
  ]
}